<!DOCTYPE html>
<html>
<head>
    <title>Test Predict Sample</title>
    <script>
        function testPredictSample(pathType) {
            let samplePath;
            
            // Different path formats to test
            switch(pathType) {
                case 'url':
                    samplePath = '/audio_samples/dog_bark.wav';
                    break;
                case 'relative':
                    samplePath = 'test_audio_samples/dog_bark.wav';
                    break;
                case 'absolute':
                    samplePath = 'D:/Urban-Sound_Classifier-Project/test_audio_samples/dog_bark.wav';
                    break;
                default:
                    samplePath = '/audio_samples/dog_bark.wav';
            }
            
            document.getElementById('path-used').textContent = samplePath;
            
            const formData = new FormData();
            formData.append('sample_path', samplePath);
            
            // Clear previous results
            document.getElementById('result').textContent = 'Loading...';
            document.getElementById('error').textContent = '';
            document.getElementById('response-headers').textContent = '';
            
            fetch('/predict_sample', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                // Display response headers
                const headers = {};
                response.headers.forEach((value, key) => {
                    headers[key] = value;
                });
                document.getElementById('response-headers').textContent = JSON.stringify(headers, null, 2);
                
                // Check if the response is JSON
                const contentType = response.headers.get('content-type');
                console.log('Content-Type:', contentType);
                
                if (!contentType || !contentType.includes('application/json')) {
                    // Not JSON, handle as text
                    return response.text().then(text => {
                        document.getElementById('result').textContent = 'Non-JSON response: ' + text.substring(0, 500) + '...';
                        throw new Error('Server returned non-JSON response');
                    });
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('result').textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('error').textContent = error.message;
            });
        }
    </script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 8px 16px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
        .section { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Test Predict Sample</h1>
    
    <div class="section">
        <h2>Test with different path formats:</h2>
        <button onclick="testPredictSample('url')">Test with URL Path</button>
        <button onclick="testPredictSample('relative')">Test with Relative Path</button>
        <button onclick="testPredictSample('absolute')">Test with Absolute Path</button>
    </div>
    
    <div class="section">
        <h2>Path used:</h2>
        <pre id="path-used"></pre>
    </div>
    
    <div class="section">
        <h2>Response Headers:</h2>
        <pre id="response-headers"></pre>
    </div>
    
    <div class="section">
        <h2>Result:</h2>
        <pre id="result"></pre>
    </div>
    
    <div class="section">
        <h2>Error:</h2>
        <pre id="error"></pre>
    </div>
</body>
</html>